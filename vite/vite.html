<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vite学习 | zys-conclusion</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/zys_notes/assets/imgs/favicon.ico">
    <meta name="description" content="Welcome to zys_notes">
    <meta name="author" content="zys">
    <meta name="keywords" content="使用vuepress">
    
    <link rel="preload" href="/zys_notes/assets/css/0.styles.a1da0401.css" as="style"><link rel="preload" href="/zys_notes/assets/js/app.27d2a2d1.js" as="script"><link rel="preload" href="/zys_notes/assets/js/2.dfcfa016.js" as="script"><link rel="preload" href="/zys_notes/assets/js/9.6f3c5772.js" as="script"><link rel="prefetch" href="/zys_notes/assets/js/10.cfacbde0.js"><link rel="prefetch" href="/zys_notes/assets/js/11.7152949e.js"><link rel="prefetch" href="/zys_notes/assets/js/12.89311dc4.js"><link rel="prefetch" href="/zys_notes/assets/js/13.f00188eb.js"><link rel="prefetch" href="/zys_notes/assets/js/14.703aa30f.js"><link rel="prefetch" href="/zys_notes/assets/js/15.c9296715.js"><link rel="prefetch" href="/zys_notes/assets/js/16.7537c97d.js"><link rel="prefetch" href="/zys_notes/assets/js/17.beaa65a7.js"><link rel="prefetch" href="/zys_notes/assets/js/18.53136da5.js"><link rel="prefetch" href="/zys_notes/assets/js/19.35e09296.js"><link rel="prefetch" href="/zys_notes/assets/js/20.b72ad227.js"><link rel="prefetch" href="/zys_notes/assets/js/21.d60756f5.js"><link rel="prefetch" href="/zys_notes/assets/js/22.c3b19fb6.js"><link rel="prefetch" href="/zys_notes/assets/js/23.55ad0ebc.js"><link rel="prefetch" href="/zys_notes/assets/js/24.9b45613e.js"><link rel="prefetch" href="/zys_notes/assets/js/25.42cf1f68.js"><link rel="prefetch" href="/zys_notes/assets/js/26.3af6579d.js"><link rel="prefetch" href="/zys_notes/assets/js/27.a765196c.js"><link rel="prefetch" href="/zys_notes/assets/js/28.9641a23b.js"><link rel="prefetch" href="/zys_notes/assets/js/29.58de9ec5.js"><link rel="prefetch" href="/zys_notes/assets/js/3.48a24a76.js"><link rel="prefetch" href="/zys_notes/assets/js/30.042fd9db.js"><link rel="prefetch" href="/zys_notes/assets/js/31.09968ecf.js"><link rel="prefetch" href="/zys_notes/assets/js/32.de245d2f.js"><link rel="prefetch" href="/zys_notes/assets/js/33.a4ef8d72.js"><link rel="prefetch" href="/zys_notes/assets/js/4.0e8dcff8.js"><link rel="prefetch" href="/zys_notes/assets/js/5.aa9851b9.js"><link rel="prefetch" href="/zys_notes/assets/js/6.99ad772a.js"><link rel="prefetch" href="/zys_notes/assets/js/7.0adce77b.js"><link rel="prefetch" href="/zys_notes/assets/js/8.e3455c10.js">
    <link rel="stylesheet" href="/zys_notes/assets/css/0.styles.a1da0401.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zys_notes/" class="home-link router-link-active"><img src="/zys_notes/assets/imgs/header.png" alt="zys-conclusion" class="logo"> <span class="site-name can-hide">zys-conclusion</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zys_notes/vp-notes/" class="nav-link">
  Vuepress
</a></div><div class="nav-item"><a href="/zys_notes/vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/zys_notes/interview/vue.html" class="nav-link">
  面试问题
</a></div><div class="nav-item"><a href="/zys_notes/timeline/" class="nav-link">
  时间线
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zys_notes/vp-notes/" class="nav-link">
  Vuepress
</a></div><div class="nav-item"><a href="/zys_notes/vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/zys_notes/interview/vue.html" class="nav-link">
  面试问题
</a></div><div class="nav-item"><a href="/zys_notes/timeline/" class="nav-link">
  时间线
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/zys_notes/" aria-current="page" class="sidebar-link">首页</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/zys_notes/vue/start" class="sidebar-heading clickable"><span>vue学习</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/zys_notes/vite/vite.html" aria-current="page" class="active sidebar-link">vite学习</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#相对于webpack优势" class="sidebar-link">相对于webpack优势</a></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#create-vite脚手架和vite" class="sidebar-link">create vite脚手架和vite</a></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#初体验-开箱即用" class="sidebar-link">初体验（开箱即用）</a></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#依赖预构建" class="sidebar-link">依赖预构建</a></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#vite配置文件智能提示和环境处理" class="sidebar-link">vite配置文件智能提示和环境处理</a></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#vite环境变量" class="sidebar-link">vite环境变量</a></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#vite解析识别vue文件" class="sidebar-link">vite解析识别vue文件</a></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#vite中css相关" class="sidebar-link">vite中css相关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#处理css大概原理" class="sidebar-link">处理css大概原理</a></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#支持less-模块化" class="sidebar-link">支持less（模块化）</a></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#vite中配置css" class="sidebar-link">vite中配置CSS</a></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#vite中配置预处理器选项-less-preprocessoroptions" class="sidebar-link">vite中配置预处理器选项（less） preprocessorOptions</a></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#devsourcemap显示源文件" class="sidebar-link">devSourcemap显示源文件</a></li></ul></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#vite中postcss" class="sidebar-link">vite中postcss</a></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#path-resolve-题外篇" class="sidebar-link">path.resolve()题外篇</a></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#vite加载静态资源" class="sidebar-link">vite加载静态资源</a></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#alias-路径别名" class="sidebar-link">alias 路径别名</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#alias原理" class="sidebar-link">alias原理</a></li></ul></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#vite在生产环境对静态资源的处理" class="sidebar-link">vite在生产环境对静态资源的处理</a></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#vite插件" class="sidebar-link">vite插件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#vite-aliases插件" class="sidebar-link">vite-aliases插件</a></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#手写vite-aliases插件" class="sidebar-link">手写vite-aliases插件</a></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#vite插件-2" class="sidebar-link">vite插件</a></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#vite-plugin-html插件" class="sidebar-link">vite-plugin-html插件</a></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#手写vite-plugin-html插件" class="sidebar-link">手写vite-plugin-html插件</a></li></ul></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#vite结合ts" class="sidebar-link">vite结合ts</a></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#vite性能优化" class="sidebar-link">vite性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#vite分包策略" class="sidebar-link">vite分包策略</a></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#gzip压缩" class="sidebar-link">gzip压缩</a></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#动态引入import" class="sidebar-link">动态引入import()</a></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#vite的cdn加速" class="sidebar-link">vite的cdn加速</a></li></ul></li><li class="sidebar-sub-header"><a href="/zys_notes/vite/vite.html#vite中跨域" class="sidebar-link">vite中跨域</a></li></ul></li><li><a href="/zys_notes/uniapp/uniapp.html" class="sidebar-link">uniapp学习</a></li><li><a href="/zys_notes/angular/angular.html" class="sidebar-link">Angular</a></li><li><a href="/zys_notes/websocket/websocket.html" class="sidebar-link">Websocket</a></li><li><section class="sidebar-group depth-0"><a href="/zys_notes/basis/" class="sidebar-heading clickable"><span>前端基础</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/zys_notes/basis/learn-html.html" class="sidebar-link">html部分</a></li><li><a href="/zys_notes/basis/learn-css.html" class="sidebar-link">css部分</a></li></ul></section></li><li><a href="/zys_notes/ajax/" class="sidebar-link">ajax</a></li><li><a href="/zys_notes/promise/" class="sidebar-link">Promise</a></li><li><a href="/zys_notes/axios/" class="sidebar-link">axios</a></li><li><a href="/zys_notes/iframe/" class="sidebar-link">iframe通信</a></li><li><section class="sidebar-group depth-0"><a href="/zys_notes/interview/" class="sidebar-heading clickable"><span>准备</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/zys_notes/interview/encapsulation.html" class="sidebar-link">实现总结</a></li><li><a href="/zys_notes/interview/vue.html" class="sidebar-link">Vue系列</a></li><li><a href="/zys_notes/interview/js.html" class="sidebar-link">JS系列</a></li><li><a href="/zys_notes/interview/css.html" class="sidebar-link">CSS系列</a></li><li><a href="/zys_notes/interview/webpack.html" class="sidebar-link">Webpack</a></li><li><a href="/zys_notes/interview/http.html" class="sidebar-link">http系列</a></li><li><a href="/zys_notes/interview/webgis.html" class="sidebar-link">WebGis系列</a></li><li><a href="/zys_notes/interview/vueDiff.html" class="sidebar-link">Vue虚拟Dom与Diff算法</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="相对于webpack优势"><a href="#相对于webpack优势" class="header-anchor">#</a> 相对于webpack优势</h2> <p>项目越大，所要处理的js代码就越多，造成的结果<code>构建工具</code>需要很长时间才能启动<code>开发服务器</code>把项目跑起来<br>
即使使用了热更新，文件修改后也要几秒钟才能在浏览器中反映出来，迟钝会影响开发者的开发效率</p> <p>webpack能改吗？</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack支持多种模块化，开始必须要统一模块化代码,</span>
<span class="token comment">// 所以意味着他需要将所有的依赖全部读一遍</span>
<span class="token keyword">const</span> lodash <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;lodash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// commonjs 规范</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span> <span class="token comment">// es6 module</span>

<span class="token comment">// webpack的一个转换结果</span>
<span class="token keyword">const</span> lodash <span class="token operator">=</span> <span class="token function">webpack_require</span><span class="token punctuation">(</span><span class="token string">&quot;lodash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Vue <span class="token operator">=</span> <span class="token function">webpack_require</span><span class="token punctuation">(</span><span class="token string">&quot;vue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>vite</code>是基于<code>es modules</code>的, 侧重点不一样, <code>webpack</code>更多的关注兼容性, 而<code>vite</code>关注浏览器端的开发体验<br> <code>vite</code>的上手难度更低，直接启动开发服务器根据<code>entry</code>按需加载<br> <img src="/zys_notes/assets/img/viteServer.30da50e4.png" alt="vite es moudle server"></p> <h2 id="create-vite脚手架和vite"><a href="#create-vite脚手架和vite" class="header-anchor">#</a> create vite脚手架和vite</h2> <ul><li><code>yarn create vite</code> <ul><li>帮我们全局安装一个东西: create-vite (vite的脚手架)</li> <li>直接运行这个create-vite bin目录的下的一个执行配置</li></ul></li></ul> <p><code>create vite</code>内置了<code>vite</code><br> <code>vue-cli</code>内置<code>webpack</code><br>
vite、create-vite ---&gt; vue团队</p> <p>使用脚手架创建<code>vue-cli</code>/<code>create vite</code>(相当于给你一套预设)：less, babel下载并配置好了<br>
自己搭建：自家下载插件处理</p> <h2 id="初体验-开箱即用"><a href="#初体验-开箱即用" class="header-anchor">#</a> 初体验（开箱即用）</h2> <p>在默认情况下，<code>es module</code>导资源要么是相对路径，要么是绝对路径，否则浏览器不知道怎么去找</p> <ul><li>那为什么es官方不默认搜寻node_modules呢？
<ul><li>如果浏览器可以做，可以找到下面<code>lodash</code>，那<code>lodash</code>下是也就会有更多的<code>import</code></li> <li>浏览器中模块是通过<code>http</code>加载的，太多的话消耗浏览器的性能</li> <li><code>commonjs</code>是运行在服务端，不一样，它找node_modules不是通过网络请求</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.html</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./man.js&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;module&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token comment">// man.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./count.js&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 安装</span>
yarn init <span class="token operator">-</span>y
yarn add lodash

<span class="token comment">// count.js</span>
<span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span><span class="token punctuation">;</span>
<span class="token comment">// 在默认情况下，es module导资源要么是相对路径</span>
<span class="token comment">// 要么是绝对路径，否则浏览器不知道怎么去找</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">// 安装</span>
yarn add vite <span class="token operator">-</span><span class="token constant">D</span>
<span class="token comment">// 安装vite会处理找到，路径补全</span>
<span class="token comment">// import _ from &quot;/node_modules/.vite/lodash&quot;;</span>
<span class="token comment">// import __vite__cjsImport0_lodash from </span>
<span class="token comment">// &quot;/node_modules/.vite/deps/lodash.js?v=55bcfa4a&quot;;</span>
</code></pre></div><h2 id="依赖预构建"><a href="#依赖预构建" class="header-anchor">#</a> 依赖预构建</h2> <p>vite找到对应的依赖后，然后调用<code>esbuild</code>将其他规范的代码转换成<code>es module</code>规范，
然后放到当前目录下的<code>node_modules/.vite/deps</code>对<code>esmodule</code>规范的各个模块进行统一集成</p> <ul><li>开发
<ul><li>yarn dev：开发环境每次重新构建vite去搜索补全路径，就是上面的<code>依赖预构建</code></li></ul></li> <li>生产
<ul><li>生产环境<code>vite</code>交给一个叫做<code>rollup</code>的库去完成打包，会兼容更多的场景，例如有的三方库（axios）是以<code>commonjs</code>规范导出，<code>module.exports</code>，</li></ul></li></ul> <ul><li>vite解决的问题
<ul><li>第三方包不同的导出格式</li> <li>路径的处理<code>node_modules/.vite/deps</code></li> <li>*** 网络多包传输的性能问题-上面举例<code>loadsh</code>下会有更多的导入问题，有了依赖预构建vite会将他们进行集成最后只生成一个或者几个模块</li></ul></li></ul> <h2 id="vite配置文件智能提示和环境处理"><a href="#vite配置文件智能提示和环境处理" class="header-anchor">#</a> vite配置文件智能提示和环境处理</h2> <p><a href="https://cn.vitejs.dev/config/#config-intellisense" target="_blank" rel="noopener noreferrer">参考官网vite配置智能提示 - https://cn.vitejs.dev/config/#config-intellisense<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>  <span class="token comment">// 第三方库</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>区分环境去区分配置文件</li> <li><code>vite.config.js</code> <ul><li>vite.base.config.js</li> <li>vite.prod.config.js</li> <li>vite.dev.config.js</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 正常 vite.config.js vite默认读取的配置文件</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">optimizeDeps</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 依赖不进行依赖预构建</span>
    <span class="token comment">// exclude: ['lodash-es']</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">import</span> viteBaseConfig <span class="token keyword">from</span> <span class="token string">&quot;./vite.base.config&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> viteProdConfig <span class="token keyword">from</span> <span class="token string">&quot;./vite.prod.config&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> viteDevConfig <span class="token keyword">from</span> <span class="token string">&quot;./vite.dev.config&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 策略模式</span>
<span class="token keyword">const</span> envResolver <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> viteBaseConfig<span class="token punctuation">,</span> viteDevConfig<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;serve&quot;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'开发环境'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> viteBaseConfig<span class="token punctuation">,</span> viteProdConfig<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> envResolver<span class="token punctuation">[</span>command<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="vite环境变量"><a href="#vite环境变量" class="header-anchor">#</a> vite环境变量</h2> <p><code>vite</code>内置了<code>dotenv</code>这个第三方库，自动读取<code>.env</code>文件解析对应环境变量，
然后将其注入到process对象下(但是vite考虑到和其他配置的一些冲突问题, 他不会直接注入到process对象下)</p> <p>涉及到<code>vite.config.js</code>中的一些配置，<code>envDir</code>: 用来配置开发/生产环境变量的文件地址<br>
可以在加载配置文件前，调用<code>vite</code>的<code>loadEnv方法</code>来手动确认<code>env</code>文件，这样就可以将.env当作所有环境下的共有变量</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// .env文件</span>
<span class="token constant">APP_KEY</span> <span class="token operator">=</span> <span class="token number">110</span>

<span class="token comment">// vite.config.js文件</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>command<span class="token punctuation">,</span> mode<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// console.log(process.env);  // 打印中没有APP_KEY</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'process.cwd() ---&gt; '</span> <span class="token operator">+</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// process.cwd()方法返回当前node进程的工作目录</span>
    <span class="token comment">// 第二个参数：当前env所在目录</span>
    <span class="token keyword">const</span> env <span class="token operator">=</span> <span class="token function">loadEnv</span><span class="token punctuation">(</span>mode<span class="token punctuation">,</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 第三个参数不传默认是.env</span>
    <span class="token comment">// console.log(env);  // 打印中就有APP_KEY了</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'command ---&gt; '</span> <span class="token operator">+</span> command<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> envResolver<span class="token punctuation">[</span>command<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>mode参数<br>
是根据命令来的<code>yarn dev</code>相当于默认<code>yarn dev --mode development</code>，mode就是development<br>
也可以手动<code>yarn dev --mode develop</code>，mode就是develop</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> env <span class="token operator">=</span> <span class="token function">loadEnv</span><span class="token punctuation">(</span>mode<span class="token punctuation">,</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 调用loadEnv, 会做如下几件事</span>
<span class="token comment">// 找到.env文件解析其中的环境变量放进一个对象</span>
<span class="token comment">// 将传进来的mode这个变量的值进行拼接: .env.development，根据拼接名称去取对应的配置文件并环境变量, 并放进一个对象</span>
<span class="token comment">// 最终得到的对象 const lastEnvConfig = { ...baseEnvConfig, ...modeEnvConfig }</span>
</code></pre></div><ul><li>客户端的使用<br>
vite会将环境变量注入到<code>import.meta.env</code>里<br>
注意vite做了一个拦截，避免将隐私性的变量直接注入进去<br>
处理是在变量前加<code>VITE_</code>，<code>VITE_APP_KEY = 120</code><br>
可以通过配置-设置环境变量前缀<code>envPrefix: 'ENV_'</code>默认是<code>VITE_</code></li></ul> <h2 id="vite解析识别vue文件"><a href="#vite解析识别vue文件" class="header-anchor">#</a> vite解析识别vue文件</h2> <p><code>yarn create vite my-vue-app --template vue</code>通过脚手架创建项目<br> <code>2、my-vue-app项目</code><br>
运行后在网络中看App.vue响应是js代码，它是如何解析的呢？初步了解开发服务器原理node<br>
新建<code>3、vite-dev-server</code>中<code>yarn add koa</code>：node端的框架<br>
通过<code>koa</code>实例返回请求地址案例，访问的App.vue文件最终是解析成js代码</p> <h2 id="vite中css相关"><a href="#vite中css相关" class="header-anchor">#</a> vite中css相关</h2> <h3 id="处理css大概原理"><a href="#处理css大概原理" class="header-anchor">#</a> 处理css大概原理</h3> <p>vite本身支持对css的处理，初体验项目里</p> <ul><li>vite在读取到main.js中引用到了Index.css</li></ul> <ol><li>直接去使用fs模块去读取index.css中文件内容</li> <li>直接创建一个style标签, 将index.css中文件内容直接copy进style标签里</li> <li>将style标签插入到index.html的<code>head</code>中</li> <li>将该css文件中的内容直接替换为js脚本(方便热更新或者css模块化), 同时设置Content-Type为js 从而让浏览器以JS脚本的形式来执行该css后缀的文件</li></ol> <ul><li>模块化场景：协同开发可能起一样的类名<br>
mian.js中引入componentA.js和componentB.js，两套css创建同样类名会出现覆盖</li></ul> <ol><li>module.css (module是一种约定, 表示需要开启css模块化)</li> <li>他会将你的所有类名进行一定规则的替换（将footer 替换成 _footer_i22st_1）</li> <li>同时创建一个映射对象{ footer: &quot;_footer_i22st_1&quot; }</li> <li>将替换过后的内容塞进style标签里然后放入到<code>head</code>标签中 (能够读到index.html的文件内容)</li> <li>将componentA.module.css内容进行全部抹除, 替换成JS脚本（看network）</li> <li>将创建的映射对象在脚本中进行默认导出</li></ol> <h3 id="支持less-模块化"><a href="#支持less-模块化" class="header-anchor">#</a> 支持less（模块化）</h3> <p>安装<code>yarn add less</code>，main.js中导入less文件<code>index.module.less</code></p> <h3 id="vite中配置css"><a href="#vite中配置css" class="header-anchor">#</a> vite中配置CSS</h3> <p><a href="https://cn.vitejs.dev/config/shared-options.html#css-modules" target="_blank" rel="noopener noreferrer">参考地址https://cn.vitejs.dev/config/shared-options.html#css-modules<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br>
在配置文件中的配置<code>vite.base.config</code>，<code>css: { modules: {} }</code></p> <ul><li>localsConvention：css生成类名key的展示形式</li> <li>scopeBehaviour：</li> <li>generateScopedName：css生成类名value的展示形式</li> <li>hashPrefix</li> <li>globalModulePaths：不参与到css模块化的路径</li></ul> <h3 id="vite中配置预处理器选项-less-preprocessoroptions"><a href="#vite中配置预处理器选项-less-preprocessoroptions" class="header-anchor">#</a> vite中配置预处理器选项（less） preprocessorOptions</h3> <p><a href="http://lesscss.cn/usage/#less-options--math" target="_blank" rel="noopener noreferrer">参考地址-http://lesscss.cn/usage/#less-options--math<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br>
在配置文件中的配置<code>vite.base.config</code>，<code>css: { preprocessorOptions: {} }</code></p> <ul><li>math：数学模式设置<br>
安装了less就可以去编译less文件，就像node直接运行文件一样，<code>npx lessc .\index.module.less</code></li> <li>globalVars：全局变量定义，不用import形式导文件<code>global.less</code></li></ul> <h3 id="devsourcemap显示源文件"><a href="#devsourcemap显示源文件" class="header-anchor">#</a> devSourcemap显示源文件</h3> <p>在配置文件中的配置<code>vite.base.config</code>，<code>css: { devSourcemap: true }</code><br>
网页header中会显示源文件，假设程序出错，就会有索引文件</p> <h2 id="vite中postcss"><a href="#vite中postcss" class="header-anchor">#</a> vite中postcss</h2> <p>vite本身就支持postcss，配置插件去做不同的事情，设计之初想承担的维护成本是要高于less的</p> <ul><li><p>例如考虑浏览器兼容，它可以做：<br>
语法降级（css变量） --- 前缀补全（--webkit） --- less编译（postcss对预处理器的插件已经停止维护，需要less自己编译，把编译结果给postcss）</p></li> <li><p>使用postcss（test-postcss项目）<br> <code>yarn add postcss-cli postcss -D</code>，<code>postcss-cli</code>使用脚手架命令，<code>postcss</code>编译操作<br> <a href="https://github.com/postcss/postcss-cli" target="_blank" rel="noopener noreferrer">postcss-cli命令参考地址-https://github.com/postcss/postcss-cli<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br> <code>npx postcss index.css -o result.css</code></p></li></ul> <p><code>postcss.config.js配置文件</code><br> <a href="https://github.com/postcss/postcss/blob/main/docs/plugins.md" target="_blank" rel="noopener noreferrer">postcss插件参考地址-https://github.com/postcss/postcss/blob/main/docs/plugins.md<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br> <code>yarn add postcss-preset-env -D</code>安装预设环境，它包含了很多必要插件，例如就可以做语法降级，自动补全等</p> <ul><li>vite中postcss的设置（test-vite项目）
<ul><li>两种方式都可</li> <li>vite配置文件中<code>css: { postcss: { plugins: [ postcssPresetEnv(/* pluginOptions */)</code></li> <li>新建<code>postcss.config.js</code>配置文件</li></ul></li></ul> <h2 id="path-resolve-题外篇"><a href="#path-resolve-题外篇" class="header-anchor">#</a> path.resolve()题外篇</h2> <p>node端去读取文件或者操作文件的时候, 如果发现你用的是相对路径, 则可使用<code>process.cwd()</code>来进行对应的拼接<br> <code>process.cwd</code>：获取当前的node执行目录<br>
commonjs规范注入的变量<code>__dirname</code>：返回的是当前文件所在的目录</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// path本质上就是一个字符串处理模块, 它里面有非常多的路径字符串处理方法</span>

<span class="token comment">// const result = fs.readFileSync('./variable.css');</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./variable.css&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    result<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token comment">// node执行目录</span>
    __dirname <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token comment">// 当前文件所在目录</span>
    path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./variable.css&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 拼接字符串，进行一个绝对路径的生成</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="vite加载静态资源"><a href="#vite加载静态资源" class="header-anchor">#</a> vite加载静态资源</h2> <p>vite对静态资源基本上是开箱即用的</p> <ul><li><code>svg</code>：不会失真，尺寸小<br>
缺点：没法很好的去表示层次丰富的图片信息，一般用<code>svg</code>去做图标</li></ul> <h2 id="alias-路径别名"><a href="#alias-路径别名" class="header-anchor">#</a> alias 路径别名</h2> <p>vite配置文件中</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;@&quot;</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;@assets&quot;</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./src/assets&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用</span>
<span class="token keyword">import</span> sylasPicUrl <span class="token keyword">from</span> <span class="token string">&quot;@assets/sylas.png&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="alias原理"><a href="#alias原理" class="header-anchor">#</a> alias原理</h3> <p><code>3、vite-dev-server</code>项目中，node端将请求资源返回的页面使用<code>alias</code>的地方进行字符串替换</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> viteConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./vite.config&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> aliasResolver <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./aliasResolver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">&quot;.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> JSContent <span class="token operator">=</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span>promises<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在服务端一般不会这么用</span>
    <span class="token comment">// 对使用alias的地方进行字符串替换</span>
    <span class="token keyword">const</span> lastResult <span class="token operator">=</span> <span class="token function">aliasResolver</span><span class="token punctuation">(</span>viteConfig<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>alias<span class="token punctuation">,</span> JSContent<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> lastResult<span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/javascript&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="vite在生产环境对静态资源的处理"><a href="#vite在生产环境对静态资源的处理" class="header-anchor">#</a> vite在生产环境对静态资源的处理</h2> <ul><li><p>打包后的静态资源为什么要有hash</p> <ul><li>刷新页面-看请求的名字是不是同一个，读取缓存</li> <li>hash算法: 将一串字符串经过运算得到一个新的乱码字符串</li></ul></li> <li><p>控制输出文件名<code>build: { rollupOptions: { output: { assetFileNames: &quot;[hash].[name].[ext]&quot; }}}</code><br> <a href="https://rollupjs.org/javascript-api/#outputoptions-object" target="_blank" rel="noopener noreferrer">rollup-output配置项参考地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <h2 id="vite插件"><a href="#vite插件" class="header-anchor">#</a> vite插件</h2> <p>就像在<code>postcss</code>中讲到，<code>less</code>和<code>postcss</code>对<code>css</code>做的不同处理<br>
vite会在<code>生命周期</code>的不同阶段中去调用不同的插件以达到不同的目的（生命周期：vite从开始执行到执行结束的过程）<br>
与webpack类似</p> <h3 id="vite-aliases插件"><a href="#vite-aliases插件" class="header-anchor">#</a> vite-aliases插件</h3> <p>自动生成别名，安装<code>yarn add vite-aliases -D</code><br> <a href="https://cn.vitejs.dev/plugins/#community-plugins" target="_blank" rel="noopener noreferrer">vite官网--&gt;插件--&gt;社区插件--&gt;搜vite-aliases<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br>
参考用法：<code>yarn add vite-aliases -D</code><br>
可能会遇到node版本问题，可以使用<code>nvm</code>方便切换node版本，<a href="https://blog.csdn.net/m0_65634497/article/details/127789013" target="_blank" rel="noopener noreferrer">nvm使用参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>使用：在vite配置文件<code>vite.base.config</code>手动设置resolve注释，导入<code>ViteAliases</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 会根据你的项目目录自动生成</span>
<span class="token punctuation">[</span>
  <span class="token punctuation">{</span><span class="token literal-property property">find</span><span class="token operator">:</span> <span class="token string">'@'</span><span class="token punctuation">,</span> <span class="token literal-property property">replacement</span><span class="token operator">:</span> <span class="token string">'${your_project_path}/src'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token literal-property property">find</span><span class="token operator">:</span> <span class="token string">'@assets'</span><span class="token punctuation">,</span> <span class="token literal-property property">replacement</span><span class="token operator">:</span> <span class="token string">'${your_project_path}/src/assets'</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="手写vite-aliases插件"><a href="#手写vite-aliases插件" class="header-anchor">#</a> 手写vite-aliases插件</h3> <ul><li>参考：<br> <a href="https://vitejs.dev/guide/api-plugin.html#vite-specific-hooks" target="_blank" rel="noopener noreferrer">vite官网--&gt;Guide--&gt;Plugin API--&gt;vite-specific-hooks--&gt;config<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br> <a href="https://cn.vitejs.dev/guide/api-plugin.html#vite-specific-hooks" target="_blank" rel="noopener noreferrer">vite官网--&gt;指引--&gt;插件 API--&gt;Vite 独有钩子--&gt;config<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>新建<code>'plugins/MyAliases'</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">(</span>keyName<span class="token operator">=</span><span class="token string">'@'</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token comment">// 在解析vite配置文件前调用config</span>
        <span class="token comment">// 返回值将会与vite配置文件合并，类似Object.assign</span>
        <span class="token function">config</span><span class="token punctuation">(</span><span class="token parameter">config<span class="token punctuation">,</span> env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> resolveAliasesObj <span class="token operator">=</span> <span class="token function">getTotalSrcDir</span><span class="token punctuation">(</span>keyName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token comment">// alias: { '@assets': 'D:\\01、web\\learn-vite\\1、test-vite\\src\\assets' }</span>
                    <span class="token literal-property property">alias</span><span class="token operator">:</span> resolveAliasesObj
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 返回指定地址下的文件夹和文件名数组</span>
fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 异步返回文件状态信息 isDirectory()</span>
fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> basePath <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="vite插件-2"><a href="#vite插件-2" class="header-anchor">#</a> vite插件</h3> <ul><li>vue团队--&gt;vite：减少开发者成本，很多东西内置调用了，开箱即用例如一些loader</li> <li>react：主动权交给开发者去维护<br> <a href="https://github.com/vitejs/vite/blob/main/packages/vite/src/node/plugins/index.ts" target="_blank" rel="noopener noreferrer">vite内部调用了很多插件参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="vite-plugin-html插件"><a href="#vite-plugin-html插件" class="header-anchor">#</a> vite-plugin-html插件</h3> <ul><li>动态控制html内容---&gt;ejs语法<code>&lt;%= %&gt;</code></li> <li>安装<code>yarn add vite-plugin-html -D</code><br> <a href="https://github.com/vbenjs/vite-plugin-html" target="_blank" rel="noopener noreferrer">vite官网--&gt;插件--&gt;社区插件--&gt;搜vite-plugin-html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>createHtmlPlugin<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite-plugin-html&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token function">createHtmlPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">inject</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;主页&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="手写vite-plugin-html插件"><a href="#手写vite-plugin-html插件" class="header-anchor">#</a> 手写vite-plugin-html插件</h3> <ul><li>参考：<br> <a href="https://vitejs.dev/guide/api-plugin.html#transformindexhtml" target="_blank" rel="noopener noreferrer">vite官网--&gt;Plugin API--&gt;Vite Special Hooks--&gt;transformIndexHtml<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>新建<code>MyCreateHtmlPlugin.js</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token comment">// 转换html的</span>
        <span class="token comment">// transformIndexHtml(html, ctx) {</span>
        <span class="token comment">//     // 注意html中body中使用，会报错没打印证明还没有执行到此处，</span>
        <span class="token comment">//     // 可能会有别的插件在这之前调用，所以我们要把执行时机提前</span>
        <span class="token comment">//     console.log(html, 1122);</span>
        <span class="token comment">// }</span>
        <span class="token literal-property property">transformIndexHtml</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// 将我们插件的一个执行时机提前</span>
            <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token string">&quot;pre&quot;</span><span class="token punctuation">,</span>
            <span class="token function-variable function">transform</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">html<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// html内容</span>
                <span class="token comment">// ctx当前请求的一个执行期上下文</span>
                <span class="token keyword">return</span> html<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;%= title %&gt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>inject<span class="token punctuation">.</span>data<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="vite结合ts"><a href="#vite结合ts" class="header-anchor">#</a> vite结合ts</h2> <p>本身对<code>TS</code>有良好的支持（类型检查、语法提示）<br> <code>6、vite-typescript</code>项目，开箱即用，但存在现象是编辑器检测错误，控制台和浏览器还正常</p> <ul><li>企业中ts检查配置，ts错误输出控制台<br> <a href="https://vite-plugin-checker.netlify.app/introduction/getting-started.html#getting-started" target="_blank" rel="noopener noreferrer">vite结合ts检测<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// yarn add vite-plugin-checker -D</span>
<span class="token comment">// yarn add typescript -D</span>
<span class="token comment">// tsconfig.json  配置ts检查规则</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;skipLibCheck&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 跳过node_modules</span>
    <span class="token property">&quot;moduleResolution&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 模块解析错略</span>
    <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ESNext&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>构建打包时，并不执行任何类型检查<br> <a href="https://cn.vitejs.dev/guide/features.html#typescript" target="_blank" rel="noopener noreferrer">构建前检查<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tsc --noEmit &amp;&amp; vite build&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><ul><li>声明提示文件，三斜线指令声明</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vite-env.d.ts文件，提示环境变量为例</span>

<span class="token comment">/// &lt;reference types=&quot;vite/client&quot; /&gt;</span>
<span class="token keyword">interface</span> <span class="token class-name">ImportMetaEnv</span> <span class="token punctuation">{</span>
    readonly <span class="token constant">VITE_PRO_URL</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="vite性能优化"><a href="#vite性能优化" class="header-anchor">#</a> vite性能优化</h2> <ul><li>开发时构建速度</li> <li>页面性能</li> <li>js</li> <li>css</li> <li>生产优化vite（rollup）/webpack：分包、压缩、treeshaking、图片资源压缩、CDN</li></ul> <h3 id="vite分包策略"><a href="#vite分包策略" class="header-anchor">#</a> vite分包策略</h3> <p>打包js中代码会压缩，关掉要在vite配置文件<code>build: { minify: false }</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 安装lodash然后mian.ts使用</span>
<span class="token comment">// ts类型声明 yarn add @types/lodash </span>
<span class="token comment">// 关掉打包不压缩</span>
</code></pre></div><p>内容只要有一点变动，打包后生成文件就会生成新的hash值，例如lodash不需要更新的文件会重新请求，所以要进行单独打包处理<br> <a href="https://rollupjs.org/configuration-options/#output-manualchunks" target="_blank" rel="noopener noreferrer">vite官网--&gt;配置--&gt;构建选项--&gt;搜rollupOptions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br> <code>6、vite-typescript</code>项目</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vite配置文件</span>
<span class="token literal-property property">build</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">minify</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 关掉打包不压缩</span>
    <span class="token literal-property property">rollupOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 配置rollup的一些构建策略</span>
        <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 控制输出</span>
            <span class="token function-variable function">manualChunks</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">id</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// includes报错，ts认为你当前环境不在es6以后，&quot;lib&quot;: [&quot;ES2017&quot;, &quot;DOM&quot;]</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'node_modules'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token string">'vendor'</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="gzip压缩"><a href="#gzip压缩" class="header-anchor">#</a> gzip压缩</h3> <p>有时候文件过大，需要将静态资源进行压缩减小体积<br>
将<code>test-vite</code>打包有如下提示，<code>chunk</code>--&gt;块的概念</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">)</span> Some chunks are larger than <span class="token number">500</span> kBs after minification<span class="token punctuation">.</span> Consider<span class="token operator">:</span>
<span class="token operator">-</span> Using dynamic <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token punctuation">)</span> to code<span class="token operator">-</span>split the application <span class="token comment">// 动态导入</span>
<span class="token operator">-</span> Use build<span class="token punctuation">.</span>rollupOptions<span class="token punctuation">.</span>output<span class="token punctuation">.</span>manualChunks to improve chunking<span class="token operator">:</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>rollupjs<span class="token punctuation">.</span>org<span class="token operator">/</span>configuration<span class="token operator">-</span>options<span class="token operator">/</span>#output<span class="token operator">-</span>manualchunks <span class="token comment">// 分包</span>
<span class="token operator">-</span> Adjust chunk size limit <span class="token keyword">for</span> <span class="token keyword">this</span> warning via build<span class="token punctuation">.</span>chunkSizeWarningLimit<span class="token punctuation">.</span>

dist<span class="token operator">/</span>assets<span class="token operator">/</span>index<span class="token operator">-</span>9c5b83c4<span class="token punctuation">.</span>js        <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">053.05</span> kB │ gzip<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">526.98</span> kB <span class="token comment">// 用gzip压缩</span>
</code></pre></div><p><a href="https://www.npmjs.com/package/vite-plugin-compression" target="_blank" rel="noopener noreferrer">使用vite-plugin-compression：npm官网--&gt;搜vite-plugin-compression<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br> <code>yarn add vite-plugin-compression -D</code></p> <ul><li>原理：服务端读取<code>index.js.gz</code>文件，已经压缩过了不用压缩，设置响应头<code>content-encoding--&gt;gzip</code>(告诉浏览器是使用gzip压缩过的)<br>
浏览器收到解压得到原本js文件</li> <li>可能存在问题：存在解压时间，体积不大不要用，适得其反</li></ul> <h3 id="动态引入import"><a href="#动态引入import" class="header-anchor">#</a> 动态引入import()</h3> <p>动态引入es6的新特性--&gt;使代码分割，和三方库按需加载相类似</p> <ul><li>常用：路由<code>component: () =&gt; import('../views/Login/Login.vue')</code>，只加载文件不执行</li> <li>webpack实现动态导入：<code>Promise</code>里<code>webpack_require.e()</code>状态</li></ul> <h3 id="vite的cdn加速"><a href="#vite的cdn加速" class="header-anchor">#</a> vite的cdn加速</h3> <ul><li>将三方依赖模块写成cdn形式注入，使代码体积更小<br>
正常打包会将三方库进行压缩<br> <code>7、vite-cdn</code>项目</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// main.js</span>
<span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">cloneDeep</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a href="https://www.npmjs.com/package/vite-plugin-cdn-import" target="_blank" rel="noopener noreferrer">使用vite-plugin-cdn-import：npm官网--&gt;搜vite-plugin-cdn-import<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br> <a href="https://www.jsdelivr.com/" target="_blank" rel="noopener noreferrer">cdn地址参考：jsdelivr官网--&gt;搜lodash<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br>
在vite配置文件中使用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">viteCDNPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'lodash'</span><span class="token punctuation">,</span>
                <span class="token keyword">var</span><span class="token operator">:</span> <span class="token string">'_'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>原理：<code>rollupOptions--&gt;externalGlobals</code></p> <h2 id="vite中跨域"><a href="#vite中跨域" class="header-anchor">#</a> vite中跨域</h2> <p><a href="/zys_notes/ajax/#同源策略">同源策略参考</a><br> <a href="/zys_notes/interview/vue.html#项目中解决跨域">参考：解决跨域 vite/webpack/nginx/CORS/JSONP</a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2023年8月2日星期三晚上11点24分</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/zys_notes/vue/learn-vue3.html" class="prev">
        vue3
      </a></span> <span class="next"><a href="/zys_notes/uniapp/uniapp.html">
        uniapp学习
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/zys_notes/assets/js/app.27d2a2d1.js" defer></script><script src="/zys_notes/assets/js/2.dfcfa016.js" defer></script><script src="/zys_notes/assets/js/9.6f3c5772.js" defer></script>
  </body>
</html>
